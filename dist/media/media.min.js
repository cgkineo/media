(function(root,factory){if(typeof define==='function'&&define.amd){define(function(){return factory(root, root.jQuery);});}else{var module = factory(root, root.jQuery);for(var k in module){root[k]=module[k];}}}(typeof self!=='undefined'?self:this,function(window,$){var exports = {}; var getURL=function(a,b,c){var d=new XMLHttpRequest;d.addEventListener("load",function(a){b.call(c,a.target.responseText)});d.open("GET",a);d.send()};var parseUnit=function(a,b,c){a=String(a||0)+String(b||"");var d=a.match(/[^0-9\.]+/g);b=b||c||"px";d&&(b=d[0]);return{value:parseFloat(a)||0,unit:b}},makeUnit=function(a,b,c){b=b||c||"px";switch(b){case "px":a=Math.round(a,0)}return a+b};var delay=function(a,b){setTimeout(a,b)},debounce=function(a,b){var c=null;return function(){var d=arguments;clearTimeout(c);c=setTimeout(function(){a.apply(this,d)}.bind(this),b||0)}};var toArray=function(a,b){return a?Array.prototype.slice.call(a,b||0):[]},isArray=function(a){return"[object Array]"==Object.prototype.toString.call(a)};var clamp=function(a,b,c){return b<a?a:b>c?c:b},isNumber=function(a){return"[object Number]"==Object.prototype.toString.call(a)};var isObject=function(a){return"[object Object]"==Object.prototype.toString.call(a)},extendNotEnumerable=function(a,b){for(var c=1,d=arguments.length;c<d;c++){var e=arguments[c];if(e){var f=Object.keys(e);c=0;for(d=f.length;c<d;c++){var h=f[c];Object.getOwnPropertyDescriptor(e,h).configurable&&Object.defineProperty(a,h,{configurable:!0,value:e[h],enumerable:!1,writable:!0})}}}return a},extend=function(a,b){a=a||{};for(var c=1,d=arguments.length;c<d;c++){var e=arguments[c],f;for(f in e)a[f]=e[f]}return a},
defaults=function(a,b){a=a||{};for(var c=1,d=arguments.length;c<d;c++){var e=arguments[c],f;for(f in e)a.hasOwnProperty(f)||(a[f]=e[f])}return a};var indexOfRegex=function(a,b,c){a=(c=c||0)?a.substring(c):a;return(b=a.match(b))?a.indexOf(b[0])+c:-1},lastIndexOfRegex=function(a,b,c){a=(c=c||0)?a.substring(0,c):a;return(b=a.match(b))?a.lastIndexOf(b[b.length-1]):-1},includes=function(a,b,c){"number"!==typeof c&&(c=0);return"string"===typeof a&&c+b.length>a.length?!1:-1!==a.indexOf(b,c)},replace=function(a,b,c){c=c||{clean:!0};replace.cache=replace.cache||{};for(var d in b){var e="\\$\\{"+d+"\\}";e=replace.cache[e]=replace.cache[e]||new RegExp("\\$\\{"+
d+"\\}","gi");a=a.replace(e,b[d])}c.clean&&(a=a.replace(/\$\{[^\}]+\}/g,""));return a};var properties=function(a,b){var c=function(a,b){return function(){return this["_"+a]=this["_"+a]||b.bind(this)}},d=!!b;b=b||a;for(var e={},f=Object.getOwnPropertyNames(b),h=0,l=f.length;h<l;h++){var g=f[h],k=g.indexOf("$");if(-1!==k||d){if(-1===k){var q="";k=g}else q=g.slice(k),k=g.slice(0,k);if(k){var n=q.split("$"),r=includes(n,"bind");q=includes(n,"get");var u=includes(n,"set"),m=includes(n,"value"),v=includes(n,"enum"),t=includes(n,"write");n=includes(n,"config");var p=0;p+=q?1:0;p+=u?1:0;p+=
m?1:0;if(1<p)throw"Cannot have two types in one definition.";p+=v?1:0;p+=t?1:0;p+=n?1:0;r?(q=!0,t=!1,r=c(k,b[g])):r=b[g];m=e[k]=e[k]||{value:r};q&&(m.get=r);u&&(m.set=r);v&&(m.enumerable=!0);t&&(m.writable=!0);n&&(m.configurable=!0);m.value&&(m.get||m.set)&&delete m.value;delete b[g];delete a[k]}}}if(!Object.keys(e).length)return a;Object.defineProperties(a,e);return a};var EventsInitialize=function(a){a.hasOwnProperty("events")&&a.events&&a.trigger||(a.hasOwnProperty("events")&&a.events||Object.defineProperty(a,"events",{value:new EventsRegistry,enumerable:!1,writable:!0}),a.trigger||Object.defineProperty(a,"trigger",{value:Events.trigger,enumerable:!1,writable:!0}))},EventsArgumentsNotation=function(a,b,c,d,e){if(a instanceof Object){c=c||e;for(var f in a)for(var h=f.split(" "),l=0,g=h.length;l<g;l++){var k=h[l];d.call(e,k,a[f],c)}}else if("string"===typeof a)for(c=
c||e,h=a.split(" "),l=0,g=h.length;l<g;l++)k=h[l],d.call(e,k,b,c);else if(void 0===a&&void 0===b&&void 0===c)return d.call(e,null,null,null)},EventsRegistry=function(){};EventsRegistry.prototype=[];var EventRegister=function(a){if(a.name){if(!a.callback)throw"Cannot find callback";EventsInitialize(a.from);EventsInitialize(a.to);this.from=a.from;this.to=a.to;this.context=a.context;this.name=a.name;this.callback=a.callback;this.once=a.once;this.from.events.push(this);this.from!==this.to&&this.to.events.push(this)}};
EventRegister.prototype.destroy=function(){this.from.events=this.from.events.filter(function(a){return a!==this}.bind(this));this.from!==this.to&&(this.to.events=this.to.events.filter(function(a){return a!==this}.bind(this)))};
var Events={events:null,listenTo:function(a,b,c){EventsArgumentsNotation(b,c,a,function(a,b,c){new EventRegister({from:c,to:this,context:this,name:a,callback:b,once:!1})},this)},listenToOnce:function(a,b,c){EventsArgumentsNotation(b,c,a,function(a,b,c){new EventRegister({from:c,to:this,context:this,name:a,callback:b,once:!0})},this)},stopListening:function(a,b,c){EventsArgumentsNotation(b,c,a,function(a,b,c){if(this.events)for(c=this.events.length-1;-1<c;c--){var d=this.events[c];d.to.events!==this.events||
null!==a&&d.name!==a||null!==b&&d.callback!==b||d.destroy()}},this)},on:function(a,b,c){EventsArgumentsNotation(a,b,c,function(a,b,c){new EventRegister({from:this,to:this,context:c,name:a,callback:b,once:!1})},this)},once:function(a,b,c){EventsArgumentsNotation(a,b,c,function(a,b,c){new EventRegister({from:this,to:this,context:c,name:a,callback:b,once:!0})},this)},off:function(a,b,c){EventsArgumentsNotation(a,b,c,function(a,b,c){if(this.events)for(c=this.events.length-1;-1<c;c--){var d=this.events[c];
d.from.events!==this.events||null!==a&&d.name!==a||null!==b&&d.callback!==b||d.destroy()}},this)},trigger:function(a){EventsInitialize(this);var b=[];if(this.events){for(var c=0,d=this.events.length;c<d;c++){var e=this.events[c];e.from.events!==this.events||"*"!==e.name&&e.name!==a||b.push(e)}b.reverse();for(c=b.length-1;-1<c;c--)e=b[c],"*"===e.name?e.callback.apply(e.context,arguments):e.callback.apply(e.context,toArray(arguments,1)),e.once&&e.destroy()}},destroy:function(){this.stopListening()}};var ClassExtend=function(a,b,c){var d=this;var e=a&&a.hasOwnProperty("constructor")?a.constructor:function(){return d.apply(this,arguments)};Object.defineProperty(e,"classOptions",{value:defaults(c,d.classOptions,{extendFunction:!0,inheritClassEnumerables:!1,classEvents:!1,classProperties:!0,instanceEvents:!1,instanceProperties:!0}),enumerable:!1,writable:!0});e.prototype=Object.create(d.prototype);e.classOptions.extendFunction&&extendNotEnumerable(e,{extend:ClassExtend});e.classOptions.classEvents&&
extendNotEnumerable(e,Events);e.classOptions.inheritClassEnumerables&&extend(e,d);extend(e,b);e.classOptions.instanceEvents&&void 0===e.prototype.events&&extendNotEnumerable(e.prototype,Events);extend(e.prototype,a);e.classOptions.instanceProperties&&(Object.defineProperty(e.prototype,"defineProperties",{value:function(a){return properties(this,a)},enumerable:!1,writable:!1,configurable:!1}),properties(e.prototype));e.classOptions.classProperties&&(Object.defineProperty(e,"defineProperties",{value:function(a){return properties(this,
a)},enumerable:!1,writable:!1,configurable:!1}),properties(e));extendNotEnumerable(e.prototype,{constructor:e});return e},ClassParent=function(a,b){},ListParent=function(a,b){};ListParent.prototype=[];ListParent.prototype.length$write=0;var Class=ClassExtend.call(ClassParent,{constructor:function(){}},{},{classEvents:!1,instanceEvents:!1}),List=ClassExtend.call(ListParent,{constructor:function(){}},{},{classEvents:!1,instanceEvents:!1});
Array.prototype.find||(List.prototype.find=function(a){for(var b=0,c=this.length;b<c;b++)if(a(this[b],b))return this[b]});var Elements=List.extend({subject:null,constructor:function(a,b){this.subject=b||document;this.add(a,this.subject);this.selector=a},filterByAttribute:function(a,b){var c=this.filter(function(c){if(c.getAttribute&&(c=c.getAttribute(a))&&(c=c.split(" "),includes(c,b)))return!0});return new Elements(c)},filterByTypes:function(a){var b=a.split(",").map(function(a){return a.trim()});a=this.filter(function(a){if(a.tagName&&(a=a.tagName.toLowerCase(),includes(b,a)))return!0});return new Elements(a)},query:function(a){var b=
new Elements;this.forEach(function(c){b.push.apply(b,c.querySelectorAll(a))});return b},isHidden:function(){return!!this.path().find(function(a){if(a instanceof Element)return a=window.getComputedStyle(a),"hidden"==a.visibility||"none"==a.display})},path:function(a){var b=this.parents();b.unshift(this[0]);a&&(b=b.filter(function(b){return elements(b).matches(a)}));return b},parents:function(a){var b=this[0],c=new Elements;if(!b)return c;do(b=b.parentNode)&&c.add(b);while(b);a&&(c=c.filter(function(b){return elements(b).matches(a)}));
return c},children:function(a){var b=this[0];if(!b)return new Elements;b=new Elements(b.children);a&&(b=b.filter(function(b){return elements(b).matches(a)}));return b},remove:function(){this.forEach(function(a){if(a.remove)return a.remove();a.parentNode&&a.parentNode.removeChild(a)})},replaceWith:function(a){var b=this[0];if(!b)return this;if(b.replaceWith)return b.replaceWith(a),this;for(var c=b.parentNode,d=0,e=c.childNodes.length;d<e;d++)if(c.childNodes[d]===b){c.insertBefore(a,b);elements(b).remove();
break}return this},prepend:function(a){var b=this[0];if(!b)return this;if(!b.childNodes.length)return b.appendChild(a),this;b.insertBefore(a,b.childNodes[0]);return this},value:function(){return this[0].value},add:function(a,b){this.selector="";b=b||document;if(a instanceof HTMLElement||a===window||a===document)return this.push(a),this;if(a instanceof Array||a instanceof NodeList||a instanceof HTMLCollection){b=0;for(var c=a.length;b<c;b++)this.add(a[b]);return this}if("string"===typeof a)for(a=b.querySelectorAll(a),
b=0,c=a.length;b<c;b++)this.push(a[b]);return this},clone:function(a){for(var b=[],c=0,d=this.length;c<d;c++)this[c].cloneNode&&b.push(this[c].cloneNode(a));return new Elements(b,this.subject)},on:function(a,b,c){c=c||{};c.passive=!1!==c.passive?!0:c.passive;if(a instanceof Object){for(var d in a)this.on(d,a[d],b);return this}this.forEach(function(d){d.addEventListener&&d.addEventListener(a,b,c)});return this},off:function(a,b){if(a instanceof Object){for(var c in a)this.off(c,a[c]);return this}this.forEach(function(c){c.removeEventListener&&
c.removeEventListener(a,b)});return this},append:function(a){this[0].appendChild(a);return this},removeAttributes:function(a){if(a)return this.removeAttribute(a);a=this.attrs();return this.removeAttribute(a)},removeAttribute:function(a){if(a instanceof Object){for(var b in a)this.removeAttribute(b);return this}this.forEach(function(b){if(b.removeAttribute)return b.removeAttribute(a);if(b.attributes.removeNamedItem&&b.attributes.getNamedItem(a))return b.attributes.removeNamedItem(a);b.setAttribute(a,
"")});return this},attrs:function(a){if(a)return this.attr(a);a={};for(var b=0,c=this[0].attributes.length;b<c;b++)a[this[0].attributes[b].name]=this[0].attributes[b].value;return a},attr:function(a,b){if(a instanceof Object){for(var c in a)this.attr(c,a[c]);return this}this.forEach(function(c){c.setAttribute&&c.setAttribute(a,b)});return this},toggleClass:function(a,b){this.forEach(function(c){switch(typeof a){case "string":a=a.split(" ")}b=void 0===b?!0:b;for(var d=c.classList,e=0,f=a.length;e<
f;e++){for(var h=a[e],l=!1,g=0,k=d.length;g<k;g++)d[g]===h&&(l=!0);!l&&b?d.add(h):l&&!b&&d.remove(h)}c.classList.length||elements(c).removeAttribute("class")});return this},html:function(a){if(void 0===a)return this[0]&&this[0].innerHTML;this.forEach(function(b){b.innerHTML=a})},dispatchEvent:function(a,b){var c=this[0];a=Elements.createEvent(a,b);c.dispatchEvent(a);return this},matches:function(a){var b=this[0];return b?b.msMatchesSelector?b.msMatchesSelector(a):b.matches(a):!1}},{createEvent:function(a,
b){b=defaults(b,{bubbles:!1,cancelable:!0});if(!Elements._ie11)try{var c=new Event(a,b);extend(c,b);return c}catch(d){Elements._ie11=!0}if(Elements._ie11)return c=document.createEvent("Event"),c.initEvent(a,b.bubbles,b.cancelable),extend(c,b),c}}),elements=function(a,b){return new Elements(a,b)};extend(elements,Elements);var Rafer=Class.extend({deferred:null,requests:null,isWaiting:!1,mode:"ram",ramLimit:50,currentDeferredLength:0,currentRequestsLength:0,constructor:function(){this.defineProperties({deferred$write:Array(100),requests$write:Array(100),currentDeferredLength$write:0,currentRequestsLength$write:0,isWaiting$write:!1})},resizeDeferred$write:function(){this.deferred.length*=2},resizeRequests$write:function(){this.requests.length*=2},set:function(a,b,c){this.isWaiting||this.request(this.dummy);this.currentDeferredLength===
this.deferred.length-1&&this.resizeDeferred();this.deferred[this.currentDeferredLength]={subject:a,name:b,value:c,type:"set"};this.currentDeferredLength++},get:function(a,b){for(var c=0,d=this.currentDeferredLength;c<d;c++){var e=this.deferred[c];if(e.subject===a&&e.name===b)return e.value}return a[b]},call:function(a,b,c){this.isWaiting||this.request(this.dummy);this.currentDeferredLength===this.deferred.length-1&&this.resizeDeferred();var d={order:0,subject:a,name:b,value:toArray(arguments,2),type:"call"};
this.deferred[this.currentDeferredLength]=d;this.currentDeferredLength++},callLast:function(a,b,c){this.isWaiting||this.request(this.dummy);this.currentDeferredLength===this.deferred.length-1&&this.resizeDeferred();var d={order:1,subject:a,name:b,value:toArray(arguments,2),type:"call"};this.deferred[this.currentDeferredLength]=d;this.currentDeferredLength++},dummy$write:function(){},flush$write:function(){var a=0;do{for(var b=[],c=this.currentDeferredLength,d=0,e=c;d<e;d++)b.push(this.deferred[d]),
this.deferred[d]=null;b.sort(function(a,b){return b.order-a.order});d=this.currentDeferredLength=0;for(e=c;d<e;d++){c=b[d];try{switch(c.type){case "set":c.subject[c.name]=c.value;break;case "call":c.name||"function"!==typeof c.subject?c.subject||"function"!==typeof c.name?c.subject[c.name].apply(c.subject,c.value):c.name.apply(c.subject,c.value):c.subject.apply(c.name,c.value)}}catch(f){debugger}}this.currentDeferredLength&&a++}while("ram"===this.mode&&0!==this.currentDeferredLength&&a<this.ramLimit);
a===this.ramLimit&&(this.mode="wait",console.log("Deferred queue modified by queue, switching to wait mode."))},request:function(a,b){!a||a._raferQueuePosition&&!b||(this.currentRequestsLength===this.requests.length&&this.resizeRequests(),this.requests[this.currentRequestsLength]=a,a._raferQueuePosition=this.currentRequestsLength+1,this.currentRequestsLength++);this.currentRequestsLength&&!this.isWaiting&&(this.isWaiting=!0,window.requestAnimationFrame(this.frame))},frame$write$bind:function(){for(var a=
[],b=this.currentRequestsLength,c=0,d=b;c<d;c++)a.push(this.requests[c]),this.requests[c]=null;c=this.currentRequestsLength=0;for(d=b;c<d;c++)a[c]._raferQueuePosition=null,a[c](),a[c]=null;this.isWaiting=!1;this.flush();this.request()}}),rafer=new Rafer;var Media=Class.extend({el:null,$el:null,options:null,requiredAPI$wrtie:["paused"],warnedAPI$write:[],constructor:function Media(a,b){if(a[Media.propName])return a;this.defineProperties({proxyEvent$write:this.proxyEvent.bind(this)});this.el=a;this.el[Media.propName]=this;this.$el=elements(this.el);this.options=b||{};this.options instanceof Media.DefaultOptions||(this.options=new Media.DefaultOptions(this.options));this.options.add({media:this,id:this.el.id});this.initialize()},initialize:function(){Media.players.push(this);
Media.trigger("create",this);this.trigger("create");this.attachEvents();delay(function(){Media.trigger("created",this);this.trigger("created");this.checkPlaying()}.bind(this),1)},checkPlaying$write:function(){if(!this.hasAPI(this.requiredAPI)||this.el.paused)return this.dispatchEvent("pause");this.dispatchEvent("play")},attachEvents$write:function(){for(var a=0,b=Media.DOMEvents.length;a<b;a++)this.el.addEventListener(Media.DOMEvents[a],this.proxyEvent)},dispatchEvent:function(a,b){"timeupdate"===
a&&(b=defaults(b,{fast:!0,medium:!0,slow:!0}));b=extend(b,{fake:!0});this.$el.dispatchEvent(a,b)},proxyEvent$write:function(a){if(a.fake||"timeupdate"!==a.type)(a.fake||"resize"!==a.type)&&this.trigger(a.type,a),Media.trigger(a.type,this,a)},hasAPI:function(a){for(var b=isArray(a)?a:toArray(arguments),c=0,d=b.length;c<d;c++){var e=b[c];if(void 0===this.el[e])return includes(this.warnedAPI,e)||(console.warn("Media: element doesn't support require api","'"+e+"'",this.el),this.warnedAPI.push(e)),!1}return!0},
destroy:function(){Media.trigger("destroy",this);this.trigger("destroy");for(var a=Media.players.length-1;-1<a;a--)Media.players[a]===this&&Media.players.splice(a,1);this.detachEvents();this.options=this.selector=null;delay(function(){delete this.el[Media.propName];this.el=null;Media.trigger("destroyed",this);this.trigger("destroyed")}.bind(this),1)},detachEvents$write:function(){for(var a=0,b=Media.DOMEvents.length;a<b;a++)this.el.removeEventListener(Media.DOMEvents[a],this.proxyEvent)}},{supportedTags$enum$write:"video, audio, canvas, img, div",
propName$enum$write:"player",Class$write:Class.extend({constructor:function(){}},{List:List.extend({constructor:function(){}},null,{instanceEvents:!0})},{instanceEvents:!0})},{classEvents:!0,instanceEvents:!0});"undefined"===typeof exports?window.Media=Media:exports.Media=Media;Media.DefaultOptions=Class.extend({constructor:function(a){this.add(a)},add$write:function(a){extend(this,a)},get$write:function(a){return this[a]},toJSON$write:function(){var a={},b;for(b in this)a[b]=this[b];return a}},{add$write$enum:function(a){var b=function(a,b){Object.defineProperty(this.prototype,a,{enumerable:!0,get:function(){return"function"===typeof this["_"+a]?this["_"+a]():this["_"+a]},set:function(b){this.hasOwnProperty("_"+a)||Object.defineProperty(this,"_"+a,{enumerable:!1,writable:!0,
value:null});var c=this["_"+a];this["_"+a]=b;c!=b&&this.trigger("change",a,b,c)}});this.prototype[a]=b}.bind(this),c;for(c in a)b(c,a[c])},get$write$enum:function(a){return this.prototype[a]},toJSON$write$enum:function(){var a={},b;for(b in this.prototype)a[b]=this.prototype[b];return a}},{instanceEvents:!0,inheritClassEnumerables:!0});Media.DefaultOptions.add({id:"",media:null});Media.Class.DOMEvents=Media.Class.List.extend({constructor:function(){},add:function(a){return a instanceof Array?this.push.apply(this,a):this.push(a)}});Media.defineProperties({DOMEvents$write:new Media.Class.DOMEvents});Media.DOMEvents.add("abort canplay canplaythrough durationchange emptied ended error loadeddata loadedmetadata loadstart pause play playing process ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "));Media.Class.Device=Media.Class.extend({isUsingTouch:!1,lastTouch:null,isUsingKeyboard:!1,lastKey:null,constructor:function(){this.checkTouchDevice();this.checkKeyboardUse()},isIOS$get$enum:function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&!window.MSStream},isIE11$get$enum:function(){return document.documentMode?!0:!1},wasUsingTouchRecently$get$enum:function(){return 600>Date.now()-this.lastTouch},wasUsingKeyboardRecently$get$enum:function(){return 600>Date.now()-this.lastKey},checkTouchDevice$write:function(){var a=
function(a){this.lastTouch=Date.now();this.isUsingTouch=!0;this.trigger("touched",a)}.bind(this);window.addEventListener("touchstart",a,{capture:!0,passive:!1});window.addEventListener("touchend",a,{capture:!0,passive:!1})},checkKeyboardUse$write:function(){var a=function(a){this.lastKey=Date.now();this.isUsingKeyboard=!0;var b=Media.DefaultOptions.get("ignorekeyboardinputselector");elements(a.srcElement).matches(b)||this.trigger("typed",a)}.bind(this);window.addEventListener("keydown",a,{capture:!0,
passive:!1});window.addEventListener("keyup",a,{capture:!0,passive:!1})}},null,{instanceEvents:!0});Media.defineProperties({device$enum:new Media.Class.Device});Media.DefaultOptions.add({ignorekeyboardinputselector:"input, textarea"});if($&&$.fn){Media=("undefined"===typeof exports?window:exports).Media;var MediaUI=("undefined"===typeof exports?window:exports).MediaUI;Media.JQueryDefaultOptions=Media.DefaultOptions.extend({constructor:function(){Media.DefaultOptions.apply(this,arguments)}});Media.JQueryDefaultOptions.add({uienabled:!0,uireplace:!0});$.fn.medias=function(a){var b=this.find(Media.supportedTags);b=b.add(this.filter(Media.supportedTags));switch(a){case "destroy":return b.each(function(a,b){b[Media.propName]instanceof
Media&&b[Media.propName].destroy()}),b}b.each(function(b,d){d[Media.propName]?d[Media.propName].options.add(a):(b=new Media.JQueryDefaultOptions(a),d=new Media(d,b),MediaUI&&new MediaUI(d,b))});return b};$.fn.play=function(){var a=this.find(Media.supportedTags);a=a.add(this.filter(Media.supportedTags));a.each(function(a,c){c.paused&&(a=c.play&&c.play())&&a.then(function(){},function(a){console.log(a)})})};$.fn.rewind=function(){var a=this.find(Media.supportedTags);a=a.add(this.filter(Media.supportedTags));
a.each(function(a,c){try{c.currentTime=0}catch(d){}c.paused&&c.play&&c.play()})};$.fn.pause=function(){var a=this.find(Media.supportedTags);a=a.add(this.filter(Media.supportedTags));a.each(function(a,c){c.paused||c.pause&&c.pause()})};$.fn.mute=function(a){var b=this.find(Media.supportedTags);b=b.add(this.filter(Media.supportedTags));b.each(function(b,d){d.muted!==a&&(d.muted=a)})}};Media.Class.DOMChanges=Media.Class.extend({constructor:function(){this.listenTo(Media,{created:this.onCreated,destroyed:this.onDestroyed})},onCreated:function(a){if(!a.mutationobserver){var b=new MutationObserver(function(b,d){a.dispatchEvent("change",{mutations:b})});b.observe(a.el,{attributes:!0,childList:!0,subtree:!0});a.defineProperties({mutationobserver$value:b});this.listenTo(a.options,"change",function(b){this.onOptionsChange(a,b)})}},onOptionsChange:function(a){a.dispatchEvent("change",{mutations:null})},
hold:function(a){this.onDestroyed(a)},resume:function(a){this.onCreated(a)},onDestroyed:function(a){a.mutationobserver&&(a.mutationobserver.disconnect(),delete a.mutationobserver,this.stopListening(a.options,"change"))}});Media.defineProperties({changes$write:new Media.Class.DOMChanges});Media.DOMEvents.add(["change"]);Media.Class.Dimensions=Media.Class.extend({_size$write:"contain",_aspect$write:"16/9",_position$write:"top left",width:parseUnit(0,"px"),height:parseUnit(0,"px"),ratio:16/9,x:parseUnit(0,"px"),y:parseUnit(0,"px"),constructor:function(a,b,c){a instanceof HTMLElement?(a=a.getBoundingClientRect(),this.width=parseUnit(a.width,"px"),this.height=parseUnit(a.height,"px"),this.ratio=a.width/a.height):a===window?(this.width=parseUnit(window.innerWidth,"px"),this.height=parseUnit(window.innerHeight,"px"),this.ratio=
this.width.value/this.height.value):(this.size=void 0===a?this._size:a,this.aspect=void 0===b?this._aspect:b,this.position=void 0===c?this._position:c)},size$set$snum:function(a){this._size=a;a=a.trim();var b=a.split(" ");a=parseUnit(b[0]||"none");b=parseUnit(b[1]||"none");switch(b.unit){case "auto":case "none":b.value=b.unit;break;case "contain":case "cover":case "fill":case "retain":a.value=b.value=b.unit=a.unit}switch(a.unit){case "auto":case "none":a.value=a.unit;break;case "contain":case "cover":case "fill":case "retain":a.value=
b.value=b.unit=a.unit}this.width=a;this.height=b},size$get$enum:function(){return this._size},aspect$set$enum:function(a){this._aspect=a;a=a.trim();a=a.replace(/:/g," ");a=a.replace(/\//g," ");a=a.replace(/\*/g,"");var b=a.split(" ");a=parseUnit(b[0]||"none");b=parseUnit(b[1]||"none");this.ratio=a.value/b.value},aspect$get$enum:function(){return this._aspect},position$set$enum:function(a){var b=Array(4);a=a.trim();var c=a.split(" ");switch(c.length){case 1:switch(c[0]){case "center":case "none":b[0]=
c[0];b[1]=0;b[2]=c[0];b[3]=0;break;case "left":case "top":case "bottom":b[0]=c[0];b[1]=0;b[2]="none";b[3]=0;break;default:b[0]="left",b[1]=c[0],b[2]="top",b[3]="50%"}break;case 2:switch(c[0]){case "left":case "top":case "bottom":case "center":case "none":b[0]=c[0];b[1]=0;break;default:b[0]="auto",b[1]=c[0]}switch(c[1]){case "left":case "top":case "bottom":case "center":case "none":b[2]=c[0];b[3]=0;break;default:b[2]="auto",b[3]=c[0]}break;case 3:throw"Unable to process a 3 part position '"+a+"'";
case 4:b=c}switch(b[0]){case "auto":switch(b[2]){case "auto":case "top":case "bottom":b[0]="left";break;case "left":case "right":b[0]="top"}}switch(b[2]){case "auto":switch(b[0]){case "auto":case "top":case "bottom":b[2]="left";break;case "left":case "right":b[2]="top"}}switch(b[2]){case "left":case "right":a=b[0],c=b[1],b[0]=b[2],b[1]=b[3],b[2]=a,b[3]=c}this.x={keyword:b[0],value:b[1]};this.y={keyword:b[2],value:b[3]}},position$get$enum:function(){return this._position}});Media.Class.Ended=Media.Class.extend({floorPrecision$write:10,requiredAPI$write:["paused","pause","currentTime","duration"],constructor:function(){this.listenTo(Media,{created:this.onCreated,play:this.onPlay,"timeupdate pause":this.onUpdate,ended:this.onEnded})},onCreated$write:function(a){a.defineProperties({hasFiredEnded$write:!1})},onPlay$write:function(a){a.hasAPI(this.requiredAPI)&&(this.isEnded(a)&&a.hasFiredEnded&&(a.el.currentTime=0),a.hasFiredEnded=!1)},onUpdate$write:function(a){a.hasAPI(this.requiredAPI)&&
(!this.isEnded(a)||a.isAtEnd?a.hasFiredEnded=!1:setTimeout(function(){a.el&&!a.hasFiredEnded&&this.isEnded(a)&&(a.el.currentTime=a.el.duration,a.el.paused||a.el.pause(),a.dispatchEvent("ended"))}.bind(this),150))},onEnded$write:function(a){a.hasAPI(this.requiredAPI)&&(a.hasFiredEnded=!0)},isEnded:function(a){return a.hasAPI(this.requiredAPI)?1>=Math.abs(Math.floor(a.el.currentTime*this.floorPrecision)-Math.floor(a.el.duration*this.floorPrecision)):!1}});Media.defineProperties({ended:new Media.Class.Ended});Media.Class.PauseOnOtherPlay=Media.Class.extend({requiredAPI$write:["paused"],constructor:function(){this.listenTo(Media,{created:this.onCreated,play:this.onPlay})},onCreated:function(a){a.defineProperties({pauseonotherplay$enum$write:a.options.pauseonotherplay})},onPlay:function(a){for(var b=0,c=Media.players;b<c;b++){var d=Media.players[b];d.pauseonotherplay&&a.hasAPI("paused")&&d.el.pause()}}});Media.defineProperties({pauseonotherplay:new Media.Class.PauseOnOtherPlay});Media.DefaultOptions.add({pauseonotherplay:!1});Media.Class.Players=Media.Class.List.extend({constructor:function(){List.apply(this,arguments)},findById:function(a){for(var b=0,c=this.length;b<c;b++){var d=this[b];if(d.el&&d.el.id===a)return d}return null},findByElement:function(a){for(var b=0,c=this.length;b<c;b++){var d=this[b];if(d.el&&d.el.id===a)return d}return null}});Media.defineProperties({players$enum$write:new Media.Class.Players});Media.Class.Resize=Media.Class.extend({constructor:function(){this.listenTo(Media,{created:this.onCreated,resize:this.onResize,change:this.onChange});this.addEventListeners()},addEventListeners$write:function(){window.removeEventListener("resize",this.onWindowResize);window.addEventListener("resize",this.onWindowResize);document.addEventListener("fullscreenchange",this.onFullScreenChanged)},onCreated:function(a){this.triggerMediaResize(a)},onFullScreenChanged$write$bind:function(){delay(this.resizeAllPlayers,
1)},onResize:function(a,b){"resize"===b.type&&b.fake||this.resizeAllPlayers()},onChange:function(a,b){this.triggerMediaResize(a)},onWindowResize$write$bind:function(){this.resizeAllPlayers()},resizeAllPlayers$bind:function(){for(var a=0,b=Media.players.length;a<b;a++)this.triggerMediaResize(Media.players[a])},triggerMediaResize:function(a){a.dispatchEvent("resize",this.getDimensions(a));a.dispatchEvent("postresize",this.getDimensions(a))},getDimensions:function(a){a=a.options;return{fullscreen:new Media.Class.Dimensions(a.mediafullscreensize,
a.mediafullscreenratio,a.mediafullscreenposition),normal:new Media.Class.Dimensions(a.mediasize,a.mediaratio,a.mediaposition)}},removeEventListeners$write:function(){window.removeEventListener("resize",this.onWindowResize);document.removeEventListener("fullscreenchange",this.onFullScreenChanged)}});Media.defineProperties({resize$write:new Media.Class.Resize});Media.DOMEvents.add(["resize","postresize"]);
Media.DefaultOptions.add({mediasize:"contain",mediaratio:"16/9",mediaposition:"none none",mediafullscreensize:function(){return this.mediasize},mediafullscreenratio:function(){return this.mediaratio},mediafullscreenposition:function(){return this.mediaposition}});Media.Class.TextTrack=Media.Class.extend({activeCues:null,cues:null,readyState:0,label:null,kind:null,language:null,el:null,media:null,mode:"hidden",_default:!1,default$get$enum:function(){return this._default},default$set$enum:function(a){if(this._default!==a){this._default=a;this.trigger("change",!0);this.media.dispatchEvent("texttrackchange",{track:this});a=0;for(var b=this.activeCues.length;a<b;a++)this.activeCues[a].isLive=!1;this.activeCues.length=0}},constructor:function(a,b){this.cues=[];
this.activeCues=[];this.el=b;this.defineProperties({media$write:a});this.default=null!==this.el.getAttribute("default");this.language=this.el.getAttribute("srclang");this.label=this.el.getAttribute("label");this.kind=this.el.getAttribute("kind");this._previousMode=this.el.mode;this.el.mode="disabled";this.el.track&&(this.el.track.mode="disabled");this.fetch()},addCue:function(a){for(var b=this.cues.length-1;-1<b;b--){var c=this.cues[b];if(c===a||c.id===a.id)return}this.cues.push(a)},removeCue:function(a){for(var b=
this.cues.length-1;-1<b;b--){var c=this.cues[b];c!==a&&c.id!==a.id||this.cues.splice(b,1)}},update$write:function(){if(this.default){this.el.mode="disabled";this.el.track&&(this.el.track.mode="disabled");var a=this.media.el.currentTime,b=this.cues.filter(function(b){return b.startTime<=a&&b.endTime>=a&&!b.isLive}),c=this.activeCues.filter(function(b){return(b.startTime>a||b.endTime<a)&&b.isLive});if(0!==b.length||0!==c.length)c.forEach(function(a){a.isLive=!1}),this.activeCues=this.activeCues.filter(function(b){return!(b.startTime>
a||b.endTime<a)}),this.activeCues.push.apply(this.activeCues,b),b.forEach(function(a){a.isLive=!0}),this.media.dispatchEvent("cuechange",{track:this,media:this})}},fetch$write:function(){this.readyState=Media.Class.TextTrack.READYSTATE.LOADING;getURL(this.el.src,function(a){a?(this.parse(a)?this.readyState=Media.Class.TextTrack.READYSTATE.LOADED:this.readyState=Media.Class.TextTrack.READYSTATE.ERROR,this.trigger("load",this)):this.readyState=Media.Class.TextTrack.READY_STATE.ERROR},this)},parse$write:function(a){var b=
-1<a.indexOf("\r\n")?"\r\n":"\n";a=a.split(b);b=[];for(var c=[],d=0,e=a.length;d<e;d++){var f=a[d],h=d===a.length-1,l=!f;h&&!l&&c.push(f);if((h||l)&&c.length){if(-1<c[0].toLowerCase().indexOf("webvtt")&&(c.splice(0,1),!c.length))continue;b.push({title:null,lines:c});c=[]}else l||c.push(f)}try{for(d=0,e=b.length;d<e;d++)if(c=b[d],0!==c.lines[0].indexOf("NOTE"))if(0===c.lines[0].indexOf("STYLE"))console.log("Media does not support STYLE lines in WebVTT yet. Please leave an issue if needed.");else{-1===
c.lines[0].indexOf("--\x3e")&&(c.title=c.lines[0],c.lines.shift());if(-1===c.lines[0].indexOf("--\x3e")){this.readyState=Media.Class.TextTrack.READYSTATE.ERROR;break}else extend(c,this.parseTimePlacement(c.lines[0])),c.lines.shift();var g=new Media.Class.TextTrackCue(c.startTime,c.endTime,c.lines.join("\n"));g.defineProperties({track$write:this});g.lineAlign=c.align;g.line=c.line;g.position=c.position;g.size=c.size;g.vertical=c.vertical;this.addCue(g)}}catch(k){return console.log(k),!1}return!0},
parseTimePlacement$write:function(a){a=a.trim();var b=indexOfRegex(a,/--\x3e/);if(-1===b)throw"Time declaration error, no --\x3e";var c=a.slice(0,b).trim();a=a.slice(b);b=indexOfRegex(a,/[0-9]+/);if(-1===b)throw"Time declaration error, no end time";a=a.slice(b);b=indexOfRegex(a,/[ ]{1}/);-1===b&&(b=a.length);var d=a.slice(0,b).trim();a=a.slice(b);return extend({startTime:this.parseTime(c),endTime:this.parseTime(d)},this.parsePlacement(a))},timeUnits$write:[.001,1,60,360],parseTime$write:function(a){a=
a.split(/[:\.,]{1}/g).reverse();if(3>a.length)throw"Time declaration error, mm:ss.ttt or hh:mm:ss.tt";for(var b=0,c=0,d=a.length;c<d;c++)b+=this.timeUnits[c]*parseInt(a[c]);return b},parsePlacement$write:function(a){var b={line:-1,position:"50%",size:"100%",align:"middle"};a.split(" ").filter(function(a){return a}).forEach(function(a){var c=a.split(":");a=c[1].split(",");c=c[0].toLowerCase();switch(c){case "d":c="vertical";break;case "l":c="line";break;case "t":c="position";break;case "s":c="size";
break;case "a":c="align";break;case "vertical":case "line":case "position":case "size":case "align":break;default:throw"Bad position declaration, "+c;}b[c]=a[0]||b[c]});b.vertical="vertical"===b.vertical?"rl":"vertical-lr"===b.vertical?"lr":"horizontal";for(var c in b)switch(a=b[c],c){case "line":a=String(a||-1);break;case "position":a=String(a||"0%");break;case "size":a=String(a||"100%");break;case "align":switch(a=String(a||"middle"),a){case "start":case "middle":case "end":break;default:throw"Invalid align declaration";
}}return b},destroy:function(){for(var a=0,b=this.cues.length;a<b;a++)this.cues[a].destroy();this.el.mode=this._previousMode;this.cues.length=0;this.activeCues.length=0;this.el=this.media=null;this.stopListening()}},{READYSTATE:{NONE:0,LOADING:1,LOADED:2,ERROR:3}});Media.DOMEvents.add(["texttrackchange","cuechange"]);Media.Class.TextTrackCue=Media.Class.extend({region:null,id:null,startTime:null,endTime:null,vertical:null,snapToLines:null,line:null,lineAlign:null,position:null,positionAlign:null,size:null,textAlign:null,text:null,track$write:null,_isLive$write:!1,isLive$get$enum:function(){return this._isLive},isLive$set$enum:function(a){var b;!this._isLive&&a?b="enter":this._isLive&&!a&&(b="exit");b&&(this._isLive=a,this.trigger(b,this),this.track.media.dispatchEvent("cue"+b,{cue:this}))},constructor:function(a,
b,c){this.id="cue-"+ ++Media.Class.TextTrackCue.id;this.startTime=a;this.endTime=b;this.text=c;this.defineProperties({_isLive$write:!1,track$write:!1})},getCueAsHTML:function(){var a=this.track.media.options.classprefix,b=document.createElement("span"),c={id:this.id,lang:this.track.language,class:a+"cue",style:""};this.renderCuePlacement(c,this);for(var d in c)b.setAttribute(d,c[d]);c=document.createElement("span");c.setAttribute("class",a+"cue-text");c.innerHTML='<span class="'+a+'cue-line">'+this.text.replace(/\n/g,
'</span><br><span class="'+a+'cue-line">')+"</span>";b.appendChild(c);return b},renderCuePlacement$write:function(a,b){var c=this.track.media.options.classprefix,d=a["class"].split(" ");d.push(c+"cue-"+b.vertical);var e="position: absolute;";switch(b.vertical){case "horizontal":e+="transform: translateX(-50%);";switch(b.lineAlign){case "start":e+="text-align: left;";d.push(c+"cue-align-left");break;case "middle":e+="text-align: center;";d.push(c+"cue-align-center");break;case "end":e+="text-align: right;",
d.push(c+"cue-align-right")}e+="width:"+b.size+";";e+="left:"+b.position+";";e=(c=-1<String(b.line).indexOf("%"))||0<=b.line?e+("top:"+b.line+"%"):e+("bottom:"+(100-100*Math.abs(b.line))+"%");break;case "rl":e+="transform: translateY(-50%);";switch(b.lineAlign){case "start":e+="text-align: left;";d.push(c+"cue-align-top");break;case "middle":e+="text-align: center;";d.push(c+"cue-align-middle");break;case "end":e+="text-align: right;",d.push(c+"cue-align-bottom")}e+="height:"+b.size+";";e+="top:"+
b.position+";";e=(c=-1<String(b.line).indexOf("%"))||0<=b.line?e+("left:"+b.line+"%"):e+("right:"+(100-100*Math.abs(b.line))+"%");break;case "lr":e+="transform: translateY(-50%);";switch(b.lineAlign){case "start":e+="text-align: left;";d.push(c+"cue-align-top");break;case "middle":e+="text-align: center;";d.push(c+"cue-align-middle");break;case "end":e+="text-align: right;",d.push(c+"cue-align-bottom")}e+="height:"+b.size+";";e+="top:"+b.position+";";(c=-1<String(b.line).indexOf("%"))||0<=b.line?
e+="right:"+b.line+"%":(b=100-100*Math.abs(b.line),e+="left:"+b+"%")}a["class"]=d.join(" ");a.style=e;return a},destroy:function(){this.media=null}},{id:0});Media.DOMEvents.add(["cueenter","cueexit"]);Media.Class.TextTrackList=Media.Class.List.extend({media$write:null,constructor:function(a){this.defineProperties({media$write:a});delay(this.fetch,0)},default$get:function(){return this.find(function(a){return a.default})},fetch$write$bind:function(){this.destroy();var a={},b=this.media.el.querySelectorAll("track[type='text/vtt']");toArray(b).forEach(function(b){var c=b.getAttribute("srclang"),d=b.getAttribute("src");c&&d&&!a[c]&&(a[c]=new Media.Class.TextTrack(this.media,b))},this);b=[];for(var c in a)b.push(a[c]);
this.addTracks(b)},addTracks$write:function(a){for(var b=0,c=a.length;b<c;b++)this.addTrack(a[b])},addTrack:function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return;this.push(a);this.trigger("add",a,this);this.media.dispatchEvent("addtexttrack",{track:a})},removeTrack:function(a){for(var b=!1,c=this.length-1;-1<c;c--)this[c]===a&&(this.splice(c,1),b=!0);b&&(this.trigger("remove",a,this),this.media.dispatchEvent("removetexttrack",{track:a}))},getTrackById:function(a){for(var b=0,c=this.length;b<
c;b++)if(this[b].el.id===a)return this[b];return null},destroy:function(){for(var a=this.length-1;-1<a;a--)this.removeTrack(this[a]);this.stopListening()}});Media.DOMEvents.add(["addtexttrack","removetexttrack"]);Media.Class.TextTracks=Media.Class.extend({constructor:function(){this.listenTo(Media,{create:this.onCreate,timeupdate:this.onTimeUpdate,destroy:this.onDestroy,change:this.onChange})},onCreate:function(a){a.defineProperties({tracks$enum$write:new Media.Class.TextTrackList(a)})},onTimeUpdate:function(a,b){if(!b||b.slow){b=0;for(var c=a.tracks.length;b<c;b++)a.tracks[b].update()}},onChange:function(a){this.onDestroy(a);this.onCreate(a);this.onTimeUpdate(a)},onDestroy:function(a){a.tracks&&(a.tracks.destroy(),
delete a.tracks)}},null,{instanceEvents:!0});Media.defineProperties({texttracks$write:new Media.Class.TextTracks});Media.Class.TimeUpdate=Media.Class.extend({playing:null,interval:null,slowInterval:null,inRaf:!1,lastTickTime:null,slowLastTickTime:null,mediumLastTickTime:null,constructor:function(){this.playing=[];this.listenTo(Media,{play:this.onPlay,"pause destroyed ended":this.onPause});this.onRaf=this.onRaf.bind(this)},onPlay:function(a){for(var b=0,c=this.playing.length;b<c;b++)if(this.playing[b]===a)return;this.playing.push(a);this.inRaf||(rafer.request(this.onRaf),this.inRaf=!0)},onRaf:function(){var a=
Media.DefaultOptions.get("fpsfast");this.interval=1E3/a;this.mediumInterval=1E3/(Media.DefaultOptions.get("fpsmedium")||a/2);this.slowInterval=1E3/(Media.DefaultOptions.get("fpsslow")||a/3);var b=Date.now();if(b<this.lastTickTime+this.interval)return this.playing.length?rafer.request(this.onRaf):this.inRaf=!1;a={fast:!0,medium:!1,slow:!1};b>=this.mediumLastTickTime+this.mediumInterval&&(this.mediumLastTickTime=b,a.medium=!0);b>=this.slowLastTickTime+this.slowInterval&&(this.slowLastTickTime=b,a.slow=
!0);this.lastTickTime=b;b=0;for(var c=this.playing.length;b<c;b++)this.playing[b].dispatchEvent("timeupdate",a);return rafer.request(this.onRaf)},onPause:function(a){for(var b=this.playing.length-1;-1<b;b--)this.playing[b]===a&&this.playing.splice(b,1)}},null,{instanceEvents:!0});Media.defineProperties({timeupdate$write:new Media.Class.TimeUpdate});Media.DefaultOptions.add({fpsfast:60,fpsmedium:30,fpsslow:12});Media.defineProperties({utils$write:{}});Media.utils.Rafer=Rafer;Media.utils.rafer=rafer;Media.utils.Class=Class;Media.utils.List=List;Media.utils.Elements=Elements;Media.utils.elements=elements;Media.utils.Events=Events;Media.utils.EventsInitialize=EventsInitialize;Media.utils.EventsArgumentsNotation=EventsArgumentsNotation;Media.utils.EventRegister=EventRegister;Media.utils.EventsRegistry=EventsRegistry;Media.utils.properties=properties;Media.utils.toArray=toArray;Media.utils.isArray=isArray;
Media.utils.isObject=isObject;Media.utils.extend=extend;Media.utils.extendNotEnumerable=extendNotEnumerable;Media.utils.defaults=defaults;Media.utils.indexOfRegex=indexOfRegex;Media.utils.lastIndexOfRegex=lastIndexOfRegex;Media.utils.includes=includes;Media.utils.replace=replace;Media.utils.clamp=clamp;Media.utils.isNumber=isNumber;Media.utils.parseUnit=parseUnit;Media.utils.makeUnit=makeUnit;Media.utils.delay=delay;Media.utils.debounce=debounce;Media.utils.getURL=getURL; return exports;}));
//# sourceMappingURL=media.min.js.map

