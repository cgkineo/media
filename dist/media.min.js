(function(window, $){
var parseUnit=function(t,e,i){var n=(t=String(t||0)+String(e||"")).match(/[^0-9\.]+/g);return e=void 0===i?"px":i,n&&(e=n[0]),{value:parseFloat(t)||0,unit:e}},toggleClass=function(t,e,i){switch(typeof e){case"string":e=e.split(" ")}i=void 0===i||i;for(var n=t.classList,r=0,s=e.length;r<s;r++){for(var a=e[r],o=!1,c=0,u=n.length;c<u;c++)n[c]===a&&(o=!0);!o&&i?n.add(a):o&&!i&&n.remove(a)}0===t.classList.length&&removeAttribute(t,"class")},removeAttribute=function(t,e){return t.removeAttribute?t.removeAttribute(e):t.attributes.removeNamedItem&&t.attributes.getNamedItem(e)?t.attributes.removeNamedItem(e):void t.setAttribute(e,"")},removeElement=function(t){if(t.remove)return t.remove();t.parentNode.removeChild(t)},replaceWith=function(t,e){if(t.replaceWith)return t.replaceWith(e);for(var i=t.parentNode,n=0,r=i.childNodes.length;n<r;n++)if(i.childNodes[n]===t)return i.insertBefore(e,t),void removeElement(t)},prependElement=function(t,e){if(!t.childNodes.length)return t.appendChild(e);t.insertBefore(e,t.childNodes[0])},createEvent=function(t,e){if(e=defaults(e,{bubbles:!1,cancelable:!0}),!createEvent.t)try{return new Event(t,e)}catch(t){createEvent.t=!0}var i;if(createEvent.t)return(i=document.createEvent("Event")).initEvent(t,e.bubbles,e.cancelable),i},delay=function(t,e){setTimeout(t,e)},debounce=function(e,i){var n=null;return function(){var t=arguments;clearTimeout(n),n=setTimeout(function(){e.apply(this,t)}.bind(this),i||0)}},bindAll=function(t,e){var i=0,n=e;e instanceof Array||(n=arguments,i=1);var r={};for(var s in t)r[s]=!0;for(var a=i,o=n.length;a<o;a++){var c=n[a],u=Object.getOwnPropertyDescriptor(t,c);if(!u||u.writable){if(!(t[c]instanceof Function)){var h="Cannot bindAll to non-function '"+c+"'";throw console.log(h,t),h}var l=r[c];Object.defineProperty(t,c,{value:t[c].bind(t),enumerable:l,writable:!0,configurable:!0})}}},getUrl=function(t,e,i){var n=new XMLHttpRequest;n.addEventListener("load",function(t){e.call(i,t.target.responseText)}),n.open("GET",t),n.send()},postUrl=function(t,e,i,n){var r=new XMLHttpRequest;r.addEventListener("load",function(t){i.call(n,t.target.responseText)}),r.open("POST",t),r.send(e)},toArray=function(t,e){return t?Array.prototype.slice.call(t,e||0):[]},isArray=function(t){return"[object Array]"==Object.prototype.toString.call(t)},find=function(t,e){for(var i=0,n=t.length;i<n;i++)if(e)return t;return null},clamp=function(t,e,i){return e<t?t:i<e?i:e},isNumber=function(t){return"[object Number]"==Object.prototype.toString.call(t)},isObject=function(t){return"[object Object]"==Object.prototype.toString.call(t)},ObjectValues=function(t){var e=[];for(var i in t)e.push(t[i]);return e},extendNotEnumerable=function(t,e){for(var i=1,n=arguments.length;i<n;i++){var r=arguments[i];if(r){var s=Object.keys(r);for(i=0,n=s.length;i<n;i++){var a=s[i];Object.getOwnPropertyDescriptor(r,a).configurable&&Object.defineProperty(t,a,{configurable:!0,value:r[a],enumerable:!1,writable:!0})}}}return t},extend=function(t,e){t=t||{};for(var i=1,n=arguments.length;i<n;i++){var r=arguments[i];for(var s in r)t[s]=r[s]}return t},deepDefaults=function(t,e){t=t||{};for(var i=1,n=arguments.length;i<n;i++){var r=arguments[i];for(var s in r)t.hasOwnProperty(s)||(t[s]=r[s]),isObject(t[s])&&(t[s]=deepDefaults(t[s],r[s]))}return t},defaults=function(t,e){t=t||{};for(var i=1,n=arguments.length;i<n;i++){var r=arguments[i];for(var s in r)t.hasOwnProperty(s)||(t[s]=r[s])}return t},get=function(t,e){for(var i=e.split(/[\/\.\:]/g);"object"==typeof(t=t[i.shift()])&&null!==t&&i.length;);return t},set=function(t,e,i){var n,r=e.split(/[\/\.\:]/g);do{if(1===r.length)break;t[n=r.shift()]||(t[n]={}),t=t[n]}while("object"==typeof t&&null!==t);n=r.shift(),void 0===i?delete t[n]:t[n]=i},indexOfRegex=function(t,e,i){var n=(i=i||0)?t.substring(i):t,r=n.match(e);return r?n.indexOf(r[0])+i:-1},lastIndexOfRegex=function(t,e,i){var n=(i=i||0)?t.substring(0,i):t,r=n.match(e);return r?n.lastIndexOf(r[r.length-1]):-1},includes=function(t,e,i){return"number"!=typeof i&&(i=0),!("string"==typeof t&&i+e.length>t.length)&&-1!==t.indexOf(e,i)},replace=function(t,e,i){for(var n in i=i||{clean:!0},replace.cache=replace.cache||{},e){var r="\\$\\{"+n+"\\}",s=replace.cache[r]=replace.cache[r]||new RegExp("\\$\\{"+n+"\\}","gi");t=t.replace(s,e[n])}return i.clean&&(t=t.replace(/\$\{[^\}]+\}/g,"")),t},template=function(string,options){for(var regexStr=/\$\{[^\^\$}]*\}/,pieces=[];string.match(regexStr);){for(;string&&(match=string.match(regexStr));){var start=match.index;pieces.push(string.slice(0,start));var end=match.index+match[0].length,evaluate=string.slice(start+2,end-1);pieces.push(eval(evaluate)),string=string.slice(end)}pieces.push(string),string=pieces.join(""),pieces.length=0}return string},properties=function(t,e){var i=!!e;e=e||t;for(var n={},r=Object.getOwnPropertyNames(e),s=0,a=r.length;s<a;s++){var o,c,u=r[s],h=u.indexOf("$");if((-1!==h||i)&&(c=-1===h?(o="",u):(o=u.slice(h),u.slice(0,h)))){var l=o.split("$"),f=includes(l,"get"),d=includes(l,"set"),v=includes(l,"value"),m=includes(l,"enum"),p=includes(l,"write"),w=includes(l,"config"),g=0;if(g+=f?1:0,g+=d?1:0,1<(g+=v?1:0))throw"Cannot have two types in one definition.";g+=m?1:0,g+=p?1:0,g+=w?1:0;var M=n[c]=n[c]||{value:e[u]};v&&(M.value=e[u]),f&&(M.get=e[u]),d&&(M.set=e[u]),m&&(M.enumerable=!0),p&&(M.writable=!0),w&&(M.configurable=!0),M.value&&(M.get||M.set)&&delete M.value,delete e[u],delete t[c]}}return Object.keys(n).length&&Object.defineProperties(t,n),t},EventsInitialize=function(t){t.events&&t.trigger||(t.events||Object.defineProperty(t,"events",{value:new EventsRegistry,enumerable:!1,writable:!0}),t.trigger||Object.defineProperty(t,"trigger",{value:Events.trigger,enumerable:!1,writable:!0}))},EventsArgumentsNotation=function(t,e,i,n,r){if(t instanceof Object){var s=t;for(var a in i=i||r,s)for(var o=0,c=(h=a.split(" ")).length;o<c;o++){var u=h[o];e=s[a],n.call(r,u,e,i)}}else if("string"==typeof t){var h;for(i=i||r,o=0,c=(h=t.split(" ")).length;o<c;o++)u=h[o],n.call(r,u,e,i)}else if(void 0===t&&void 0===e&&void 0===i)return n.call(r,null,null,null)},EventsRegistry=function(){};EventsRegistry.prototype=new Array;var EventRegister=function(t){if(t.name){if(!t.callback)throw"Cannot find callback";EventsInitialize(t.from),EventsInitialize(t.to),this.from=t.from,this.to=t.to,this.context=t.context,this.name=t.name,this.callback=t.callback,this.once=t.once,this.from.events.push(this),this.from!==this.to&&this.to.events.push(this)}};EventRegister.prototype.destroy=function(){this.from.events=this.from.events.filter(function(t){return t!==this}.bind(this)),this.from!==this.to&&(this.to.events=this.to.events.filter(function(t){return t!==this}.bind(this)))};var Events={events:null,listenTo:function(t,e,i){EventsArgumentsNotation(e,i,t,function(t,e,i){new EventRegister({from:i,to:this,context:this,name:t,callback:e,once:!1})},this)},listenToOnce:function(t,e,i){EventsArgumentsNotation(e,i,t,function(t,e,i){new EventRegister({from:i,to:this,context:this,name:t,callback:e,once:!0})},this)},stopListening:function(t,e,i){EventsArgumentsNotation(e,i,t,function(t,e,i){if(this.events)for(var n=this.events.length-1;-1<n;n--){var r=this.events[n];r.to.events===this.events&&(null!==t&&r.name!==t||null!==e&&r.callback!==e||r.destroy())}},this)},on:function(t,e,i){EventsArgumentsNotation(t,e,i,function(t,e,i){new EventRegister({from:this,to:this,context:i,name:t,callback:e,once:!1})},this)},once:function(t,e,i){EventsArgumentsNotation(t,e,i,function(t,e,i){new EventRegister({from:this,to:this,context:i,name:t,callback:e,once:!0})},this)},off:function(t,e,i){EventsArgumentsNotation(t,e,i,function(t,e,i){if(this.events)for(var n=this.events.length-1;-1<n;n--){var r=this.events[n];r.from.events===this.events&&(null!==t&&r.name!==t||null!==e&&r.callback!==e||r.destroy())}},this)},trigger:function(t){EventsInitialize(this);var e=[];if(this.events){for(var i=0,n=this.events.length;i<n;i++)(r=this.events[i]).from.events===this.events&&("*"!==r.name&&r.name!==t||e.push(r));for(e.reverse(),i=e.length-1;-1<i;i--){var r;"*"===(r=e[i]).name?r.callback.apply(r.context,arguments):r.callback.apply(r.context,toArray(arguments,1)),r.once&&r.destroy()}}},destroy:function(){this.stopListening()}},ClassExtend=function(t,e,i){var n,r=this;return n=t&&t.hasOwnProperty("constructor")?t.constructor:function(){return r.apply(this,arguments)},Object.defineProperty(n,"classOptions",{value:defaults(i,r.classOptions,{extendFunction:!0,inheritClassEnumerables:!1,classEvents:!1,classProperties:!0,instanceEvents:!1,instanceProperties:!0}),enumerable:!1,writable:!0}),n.prototype=Object.create(r.prototype),n.classOptions.extendFunction&&extendNotEnumerable(n,{extend:ClassExtend}),n.classOptions.classEvents&&extendNotEnumerable(n,Events),n.classOptions.inheritClassEnumerables&&extend(n,r),extend(n,e),n.classOptions.instanceEvents&&void 0===n.prototype.events&&extendNotEnumerable(n.prototype,Events),extend(n.prototype,t),n.classOptions.instanceProperties&&(Object.defineProperty(n.prototype,"defineProperties",{value:function(t){return properties(this,t)},enumerable:!1,writable:!1,configurable:!1}),properties(n.prototype)),n.classOptions.classProperties&&(Object.defineProperty(n,"defineProperties",{value:function(t){return properties(this,t)},enumerable:!1,writable:!1,configurable:!1}),properties(n)),extendNotEnumerable(n.prototype,{constructor:n}),n},ClassParent=function(t,e){},ListParent=function(t,e){};ListParent.prototype=new Array,Array.prototype.find||(List.prototype.find=function(t){for(var e=0,i=this.length;e<i;e++)if(t(this[e],e))return!0;return!1});var Class=ClassExtend.call(ClassParent,{constructor:function(){}},{},{classEvents:!1,instanceEvents:!1}),List=ClassExtend.call(ListParent,{constructor:function(){}},{},{classEvents:!1,instanceEvents:!1}),Elements=List.extend({subject:null,constructor:function(t,e){this.subject=e||document,this.add(t,this.subject),this.selector=t},filterByAttribute:function(n,r){var t=this.filter(function(t){var e=t.getAttribute(n);if(e){var i=e.split(" ");return!!includes(i,r)||void 0}});return new Elements(t)},filterByTypes:function(t){var i=t.split(",").map(function(t){return t.trim()}),e=this.filter(function(t){var e=t.tagName.toLowerCase();if(includes(i,e))return!0});return new Elements(e)},query:function(e){var i=new Elements;return this.forEach(function(t){i.push.apply(i,t.querySelectorAll(e))}),i},isHidden:function(){var t=this.stack();return Boolean(t.find(function(t){var e=window.getComputedStyle(t);return"hidden"==e.visibility||"none"==e.display||0==e.opacity}))},stack:function(e){var t=this.parents();return t.unshift(this[0]),e&&(t=t.filter(function(t){return t.matches(e)})),t},parents:function(e){for(var t=this[0],i=new Elements;(t=t.parentNode)&&i.add(t),t;);return e&&(i=i.filter(function(t){return t.matches(e)})),i},value:function(){return this[0].value},add:function(t,e){if(this.selector="",e=e||document,t instanceof HTMLElement)return this.push(t),this;if(t instanceof Array||t instanceof NodeList){for(var i=0,n=t.length;i<n;i++)this.add(t[i]);return this}if("string"!=typeof t)return this;var r=e.querySelectorAll(t);for(i=0,n=r.length;i<n;i++)this.push(r[i]);return this},clone:function(t){for(var e=[],i=0,n=this.length;i<n;i++)e.push(this[i].cloneNode(t));return new Elements(e,this.subject)},on:function(e,i,n){if((n=n||{}).passive=!1!==n.passive||n.passive,e instanceof Object){for(var t in e)this.on(t,e[t],i);return this}return this.forEach(function(t){t.addEventListener(e,i,n)}),this},off:function(e,i){if(e instanceof Object){for(var t in e)this.off(t,e[t]);return this}return this.forEach(function(t){t.removeEventListener(e,i)}),this},removeAttributes:function(t){return t||(t=this.attrs()),this.removeAttribute(t)},removeAttribute:function(e){if(e instanceof Object){for(var t in e)this.removeAttribute(t);return this}return this.forEach(function(t){removeAttribute(t,e)}),this},attrs:function(t){if(t)return this.attr(t);t={};for(var e=0,i=this[0].attributes.length;e<i;e++)t[this[0].attributes[e].name]=this[0].attributes[e].value;return t},attr:function(e,i){if(e instanceof Object){for(var t in e)this.attr(t,e[t]);return this}return this.forEach(function(t){t.setAttribute(e,i)}),this},toggleClass:function(e,i){return this.forEach(function(t){toggleClass(t,e,i)}),this}}),elements=function(t,e){return new Elements(t,e)};extend(elements,Elements);var Rafer=Class.extend({deferred:null,requests:null,isWaiting:!1,mode:"ram",ramLimit:50,currentDeferredLength:0,currentRequestsLength:0,constructor:function(){bindAll(this,"frame"),this.defineProperties({deferred$write:new Array(100),requests$write:new Array(100),currentDeferredLength$write:0,currentRequestsLength$write:0,isWaiting$write:!1})},resizeDeferred$write:function(){var t=2*this.deferred.length;this.deferred.length=t},resizeRequests$write:function(){var t=2*this.requests.length;this.requests.length=t},set:function(t,e,i){this.isWaiting||this.request(this.dummy),this.currentDeferredLength===this.deferred.length-1&&this.resizeDeferred();var n={subject:t,name:e,value:i,type:"set"};this.deferred[this.currentDeferredLength]=n,this.currentDeferredLength++},get:function(t,e){for(var i=0,n=this.currentDeferredLength;i<n;i++){var r=this.deferred[i];if(r.subject===t&&r.name===e)return r.value}return t[e]},call:function(t,e,i){this.isWaiting||this.request(this.dummy),this.currentDeferredLength===this.deferred.length-1&&this.resizeDeferred();var n={order:0,subject:t,name:e,value:toArray(arguments,2),type:"call"};this.deferred[this.currentDeferredLength]=n,this.currentDeferredLength++},callLast:function(t,e,i){this.isWaiting||this.request(this.dummy),this.currentDeferredLength===this.deferred.length-1&&this.resizeDeferred();var n={order:1,subject:t,name:e,value:toArray(arguments,2),type:"call"};this.deferred[this.currentDeferredLength]=n,this.currentDeferredLength++},dummy$write:function(){},flush$write:function(){var t=0;do{for(var e=[],i=this.currentDeferredLength,n=0,r=i;n<r;n++)e.push(this.deferred[n]),this.deferred[n]=null;for(e.sort(function(t,e){return e.order-t.order}),n=this.currentDeferredLength=0,r=i;n<r;n++){var s=e[n];try{switch(s.type){case"set":s.subject[s.name]=s.value;break;case"call":s.name||"function"!=typeof s.subject?s.subject||"function"!=typeof s.name?s.subject[s.name].apply(s.subject,s.value):s.name.apply(s.subject,s.value):s.subject.apply(s.name,s.value)}}catch(t){}}this.currentDeferredLength&&t++}while("ram"===this.mode&&0!==this.currentDeferredLength&&t<this.ramLimit);t===this.ramLimit&&(this.mode="wait",console.log("Deferred queue modified by queue, switching to wait mode."))},request:function(t,e){!t||t.e&&!e||(this.currentRequestsLength===this.requests.length&&this.resizeRequests(),(this.requests[this.currentRequestsLength]=t).e=this.currentRequestsLength+1,this.currentRequestsLength++),this.currentRequestsLength&&(this.isWaiting||(this.isWaiting=!0,window.requestAnimationFrame(this.frame)))},frame$write:function(){for(var t=[],e=this.currentRequestsLength,i=0,n=e;i<n;i++)t.push(this.requests[i]),this.requests[i]=null;for(i=this.currentRequestsLength=0,n=e;i<n;i++)t[i].e=null,t[i](),t[i]=null;this.isWaiting=!1,this.flush(),this.request()}}),rafer=new Rafer,Media=Class.extend({el:null,options:null,constructor:function t(e,i){if(e[t.propName])return e;this.defineProperties({proxyEvent$write:this.proxyEvent.bind(this)}),this.el=e,(this.el[t.propName]=this).options=i||{},this.options instanceof t.DefaultOptions||(this.options=new t.DefaultOptions(this.options)),this.options.add({media:this,id:this.el.id}),this.initialize()},initialize:function(){Media.players.push(this),Media.trigger("create",this),this.trigger("create"),this.attachEvents(),delay(function(){Media.trigger("created",this),this.trigger("created"),this.checkPlaying()}.bind(this),1)},checkPlaying$write:function(){this.el.paused||this.dispatchEvent("play")},attachEvents$write:function(){for(var t=0,e=Media.DOMEvents.length;t<e;t++)this.el.addEventListener(Media.DOMEvents[t],this.proxyEvent)},dispatchEvent:function(t,e){"timeupdate"===t&&(e=defaults(e,{fast:!0,medium:!0,slow:!0}));var i=createEvent(t,e);i.fake=!0,extend(i,e),this.el.dispatchEvent(i)},proxyEvent$write:function(t){!t.fake&&"timeupdate"===t.type||(!t.fake&&"resize"===t.type||this.trigger(t.type,t),Media.trigger(t.type,this,t))},destroy:function(){Media.trigger("destroy",this),this.trigger("destroy");for(var t=Media.players.length-1;-1<t;t--)Media.players[t]===this&&Media.players.splice(t,1);this.detachEvents(),this.selector=null,this.options=null,delay(function(){delete this.el[Media.propName],this.el=null,Media.trigger("destroyed",this),this.trigger("destroyed")}.bind(this),1)},detachEvents$write:function(){for(var t=0,e=Media.DOMEvents.length;t<e;t++)this.el.removeEventListener(Media.DOMEvents[t],this.proxyEvent)}},{supportedTags$enum$write:"video, audio, canvas, img",propName$enum$write:"player",Class$write:Class.extend({constructor:function(){}},{List:List.extend({constructor:function(){}},null,{instanceEvents:!0})},{instanceEvents:!0})},{classEvents:!0,instanceEvents:!0});window.Media=Media,Media.DefaultOptions=Class.extend({constructor:function(t){this.add(t)},add$write:function(t){extend(this,t)},get$write:function(t){return this[t]},toJSON$write:function(){var t={};for(var e in this)t[e]=this[e];return t}},{add$write$enum:function(t){var e=function(e,t){Object.defineProperty(this.prototype,e,{enumerable:!0,get:function(){return"function"==typeof this["_"+e]?this["_"+e]():this["_"+e]},set:function(t){this.hasOwnProperty("_"+e)||Object.defineProperty(this,"_"+e,{enumerable:!1,writable:!0,value:null}),this["_"+e]=t}}),this.prototype[e]=t}.bind(this);for(var i in t)e(i,t[i])},get$write$enum:function(t){return this.prototype[t]},toJSON$write$enum:function(){var t={};for(var e in this.prototype)t[e]=this.prototype[e];return t}},{inheritClassEnumerables:!0}),Media.DefaultOptions.add({id:"",media:null}),Media.Class.DOMEvents=Media.Class.List.extend({constructor:function(){},add:function(t){return t instanceof Array?this.push.apply(this,t):this.push(t)}}),Media.defineProperties({DOMEvents$write:new Media.Class.DOMEvents}),Media.DOMEvents.add(["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","process","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"]),Media.Class.Device=Media.Class.extend({isUsingTouch:!1,lastTouch:null,constructor:function(){this.checkTouchDevice()},isIOS$get$enum:function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&!window.MSStream},wasTouchedRecently$get$enum:function(){return Date.now()-this.lastTouch<600},checkTouchDevice$write:function(){var t=function(){this.lastTouch=Date.now(),this.isUsingTouch=!0}.bind(this);window.addEventListener("touchstart",t,{capture:!0,passive:!0}),window.addEventListener("touchend",t,{capture:!0,passive:!0})}}),Media.defineProperties({device$enum:new Media.Class.Device}),$&&$.fn&&(Media.JQueryDefaultOptions=Media.DefaultOptions.extend({constructor:function(){Media.DefaultOptions.prototype.constructor.apply(this,arguments)}}),Media.JQueryDefaultOptions.add({uienabled:!0,uireplace:!0}),$.fn.medias=function(n){var t=this.find(Media.supportedTags);switch(t=t.add(this.filter(Media.supportedTags)),n){case"destroy":return t.each(function(t,e){e[Media.propName]instanceof Media&&e[Media.propName].destroy()}),t}return t.each(function(t,e){if(!e[Media.i]){n=new Media.JQueryDefaultOptions(n);var i=new Media(e,n);new MediaUI(i,n)}}),t},$.fn.play=function(){var t=this.find(Media.supportedTags);(t=t.add(Media.supportedTags)).each(function(t,e){e.play&&e.play()})},$.fn.pause=function(){var t=this.find(Media.supportedTags);(t=t.add(this.filter(Media.supportedTags))).each(function(t,e){e.pause&&e.pause()})}),Media.Class.Dimensions=Media.Class.extend({n:"contain",r:"16/9",s:"top left",width:parseUnit(0,"px"),height:parseUnit(0,"px"),ratio:16/9,x:parseUnit(0,"px"),y:parseUnit(0,"px"),constructor:function(t,e,i){if(t instanceof HTMLElement){var n=t.getBoundingClientRect();return this.width=parseUnit(n.width,"px"),this.height=parseUnit(n.height,"px"),void(this.ratio=n.width/n.height)}if(t===window)return this.width=parseUnit(window.innerWidth,"px"),this.height=parseUnit(window.innerHeight,"px"),void(this.ratio=this.width.value/this.height.value);this.size=void 0===t?this.a:t,this.aspect=void 0===e?this.o:e,this.position=void 0===i?this.c:i},size$set$snum:function(t){var e=(t=(this.a=t).trim()).split(" "),i=parseUnit(e[0]||"none"),n=parseUnit(e[1]||"none");switch(n.unit){case"auto":case"none":n.value=n.unit;break;case"contain":case"cover":case"fill":case"retain":i.value=n.value=n.unit=i.unit}switch(i.unit){case"auto":case"none":i.value=i.unit;break;case"contain":case"cover":case"fill":case"retain":i.value=n.value=n.unit=i.unit}this.width=i,this.height=n},size$get$enum:function(){return this.a},aspect$set$enum:function(t){var e=(t=(t=(t=(t=(this.o=t).trim()).replace(/\:/g," ")).replace(/\//g," ")).replace(/\*/g,"")).split(" "),i=parseUnit(e[0]||"none"),n=parseUnit(e[1]||"none");this.ratio=i.value/n.value},aspect$get$enum:function(){return this.o},position$set$enum:function(t){var e=new Array(4),i=(t=t.trim()).split(" ");switch(i.length){case 1:switch(i[0]){case"center":case"none":e[0]=i[0],e[1]=0,e[2]=i[0],e[3]=0;break;case"left":case"top":case"bottom":e[0]=i[0],e[1]=0,e[2]="none",e[3]=0;break;default:e[0]="left",e[1]=i[0],e[2]="top",e[3]="50%"}break;case 2:switch(i[0]){case"left":case"top":case"bottom":case"center":case"none":e[0]=i[0],e[1]=0;break;default:e[0]="auto",e[1]=i[0]}switch(i[1]){case"left":case"top":case"bottom":case"center":case"none":e[2]=i[0],e[3]=0;break;default:e[2]="auto",e[3]=i[0]}break;case 3:throw"Unable to process a 3 part position '"+t+"'";case 4:e=i}switch(e[0]){case"auto":switch(e[2]){case"auto":case"top":case"bottom":e[0]="left";break;case"left":case"right":e[0]="top"}}switch(e[2]){case"auto":switch(e[0]){case"auto":case"top":case"bottom":e[2]="left";break;case"left":case"right":e[2]="top"}}switch(e[2]){case"left":case"right":var n=e[0],r=e[1];e[0]=e[2],e[1]=e[3],e[2]=n,e[3]=r}this.x={keyword:e[0],value:e[1]},this.y={keyword:e[2],value:e[3]}},position$get$enum:function(){return this.c}}),Media.Class.Ended=Media.Class.extend({floorPrecision:10,constructor:function(){this.listenTo(Media,{created:this.onCreated,play:this.onPlay,pause:this.onPause,ended:this.onEnded})},onCreated:function(t){t.defineProperties({hasFiredEnded$write:!1})},onPlay:function(t){t.hasFiredEnded=!1},onPause:function(t){this.isEnded(t)&&!t.isAtEnd&&setTimeout(function(){t.el&&(t.hasFiredEnded||this.isEnded(t)&&t.el.dispatchEvent(createEvent("ended")))}.bind(this),150)},onEnded:function(t){t.hasFiredEnded=!0},isEnded:function(t){return Math.abs(Math.floor(t.el.currentTime*this.floorPrecision)-Math.floor(t.el.duration*this.floorPrecision))<=1}}),Media.defineProperties({ended:new Media.Class.Ended}),Media.Class.PauseOnPlay=Media.Class.extend({constructor:function(){this.listenTo(Media,{created:this.onCreated,play:this.onPlay})},onCreated:function(t){t.defineProperties({pauseonplay$enum$write:t.options.pauseonplay})},onPlay:function(t){for(var e=0,i=Media.players;e<i;e++){var n=Media.players[e];n.pauseonplay&&n.el.pause()}}}),Media.defineProperties({pauseonplay:new Media.Class.PauseOnPlay}),Media.DefaultOptions.add({pauseonplay:!1}),Media.Class.Players=Media.Class.List.extend({constructor:function(){List.apply(this,arguments)},findById:function(t){for(var e=0,i=this.length;e<i;e++){var n=this[e];if(n.el&&n.el.id===t)return n}return null},findByElement:function(t){for(var e=0,i=this.length;e<i;e++){var n=this[e];if(n.el&&n.el.id===t)return n}return null}}),Media.defineProperties({players$enum$write:new Media.Class.Players}),Media.Class.Resize=Media.Class.extend({constructor:function(t){bindAll(this,"onWindowResize","onFullScreenChanged"),this.listenTo(Media,{created:this.onCreated,resize:this.onResize}),this.addEventListeners()},addEventListeners$write:function(){window.removeEventListener("resize",this.onWindowResize),window.addEventListener("resize",this.onWindowResize),document.addEventListener("fullscreenchange",this.onFullScreenChanged)},onCreated:function(t){this.triggerMediaResize(t)},onFullScreenChanged$write:function(){this.resizeAllPlayers()},onResize:function(t,e){e.fake||this.resizeAllPlayers()},onWindowResize$write:function(){this.resizeAllPlayers()},resizeAllPlayers$write:function(){for(var t=0,e=Media.players.length;t<e;t++){var i=Media.players[t];this.triggerMediaResize(i)}},triggerMediaResize:function(t){var e=t.options;t.dispatchEvent("resize",{fullscreen:new Media.Class.Dimensions(e.mediafullscreensize,e.mediafullscreenratio,e.mediafullscreenposition),normal:new Media.Class.Dimensions(e.mediasize,e.mediaratio,e.mediaposition)}),t.dispatchEvent("postresize",{fullscreen:new Media.Class.Dimensions(e.mediafullscreensize,e.mediafullscreenratio,e.mediafullscreenposition),normal:new Media.Class.Dimensions(e.mediasize,e.mediaratio,e.mediaposition)})},removeEventListeners$write:function(){window.removeEventListener("resize",this.onWindowResize),document.removeEventListener("fullscreenchange",this.onFullScreenChanged)}}),Media.defineProperties({resize$write:new Media.Class.Resize}),Media.DOMEvents.add(["resize","postresize"]),Media.DefaultOptions.add({mediasize:"contain",mediaratio:"16/9",mediaposition:"none none",mediafullscreensize:function(){return this.mediasize},mediafullscreenratio:function(){return this.mediaratio},mediafullscreenposition:function(){return this.mediaposition}}),Media.Class.TextTrack=Media.Class.extend({activeCues:null,cues:null,readyState:0,label:null,kind:null,language:null,el:null,media:null,mode:"hidden",u:!1,default$get$enum:function(){return this.u},default$set$enum:function(t){if(this.u!==t){this.u=t,this.trigger("change",!0),this.media.dispatchEvent("texttrackchange",{track:this});for(var e=0,i=this.activeCues.length;e<i;e++)this.activeCues[e].isLive=!1;this.activeCues.length=0}},constructor:function(t,e){this.cues=[],this.activeCues=[],this.el=e,this.defineProperties({media$write:t}),this.default=null!==this.el.getAttribute("default"),this.language=this.el.getAttribute("srclang"),this.label=this.el.getAttribute("label"),this.kind=this.el.getAttribute("kind"),this.h=this.el.mode,this.el.mode="disabled",this.fetch()},addCue:function(t){for(var e=this.cues.length-1;-1<e;e--){var i=this.cues[e];if(i===t||i.id===t.id)return}this.cues.push(t)},removeCue:function(t){for(var e=this.cues.length-1;-1<e;e--){var i=this.cues[e];i!==t&&i.id!==t.id||this.cues.splice(e,1)}},update$write:function(){if(this.default){var e=this.media.el.currentTime,t=this.cues.filter(function(t){return t.startTime<=e&&t.endTime>=e&&!t.isLive}),i=this.activeCues.filter(function(t){return(t.startTime>e||t.endTime<e)&&t.isLive});0===t.length&&0===i.length||(i.forEach(function(t){t.isLive=!1}),this.activeCues=this.activeCues.filter(function(t){return!(t.startTime>e||t.endTime<e)}),this.activeCues.push.apply(this.activeCues,t),t.forEach(function(t){t.isLive=!0}),this.media.dispatchEvent("cuechange",{track:this,media:this}))}},fetch$write:function(){this.readyState=Media.Class.TextTrack.READYSTATE.LOADING,getUrl(this.el.src,function(t){t?(this.parse(t)?this.readyState=Media.Class.TextTrack.READYSTATE.LOADED:this.readyState=Media.Class.TextTrack.READYSTATE.ERROR,this.trigger("load",this)):this.readyState=Media.Class.TextTrack.l.ERROR},this)},parse$write:function(t){for(var e=-1<t.indexOf("\r\n")?"\r\n":"\n",i=t.split(e),n=[],r=[],s=0,a=i.length;s<a;s++){var o=i[s],c=s===i.length-1,u=!o;if(c&&!u&&r.push(o),(c||u)&&r.length){if(-1<r[0].toLowerCase().indexOf("webvtt")&&(r.splice(0,1),!r.length))continue;n.push({title:null,lines:r}),r=[]}else u||r.push(o)}try{for(s=0,a=n.length;s<a;s++)if(0!==(r=n[s]).lines[0].indexOf("NOTE"))if(0===r.lines[0].indexOf("STYLE"))console.log("Media does not support STYLE lines in WebVTT yet. Please leave an issue if needed.");else{if(-1===r.lines[0].indexOf("--\x3e")&&(r.title=r.lines[0],r.lines.shift()),-1===r.lines[0].indexOf("--\x3e")){this.readyState=Media.Class.TextTrack.READYSTATE.ERROR;break}extend(r,this.parseTimePlacement(r.lines[0])),r.lines.shift();var h=new Media.Class.TextTrackCue(r.startTime,r.endTime,r.lines.join("\n"));h.defineProperties({track$write:this}),h.lineAlign=r.align,h.line=r.line,h.position=r.position,h.size=r.size,h.vertical=r.vertical,this.addCue(h)}}catch(t){return console.log(t),!1}return!0},parseTimePlacement$write:function(t){if(t=t.trim(),-1===(i=indexOfRegex(t,/-->/)))throw"Time declaration error, no --\x3e";var e=t.slice(0,i).trim();t=t.slice(i);var i,n=indexOfRegex(t,/[0-9]+/);if(-1===n)throw"Time declaration error, no end time";t=t.slice(n),-1===(i=indexOfRegex(t,/[ ]{1}/))&&(i=t.length);var r=t.slice(0,i).trim();return t=t.slice(i),extend({startTime:this.parseTime(e),endTime:this.parseTime(r)},this.parsePlacement(t))},timeUnits$write:[.001,1,60,360],parseTime$write:function(t){var e=t.split(/[\:\.\,]{1}/g).reverse();if(e.length<3)throw"Time declaration error, mm:ss.ttt or hh:mm:ss.tt";for(var i=0,n=0,r=e.length;n<r;n++)i+=this.timeUnits[n]*parseInt(e[n]);return i},parsePlacement$write:function(t){var e=t.split(" ").filter(function(t){return t}),r={line:-1,position:"50%",size:"100%",align:"middle"};for(var i in e.forEach(function(t){var e=t.split(":"),i=e[1].split(","),n=e[0].toLowerCase();switch(n){case"d":n="vertical";break;case"l":n="line";break;case"t":n="position";break;case"s":n="size";break;case"a":n="align";break;case"vertical":case"line":case"position":case"size":case"align":break;default:throw"Bad position declaration, "+n}r[n]=i[0]||r[n]}),r.vertical="vertical"===r.vertical?"rl":"vertical-lr"===r.vertical?"lr":"horizontal",r){var n=r[i];switch(i){case"line":n=String(n||-1);break;case"position":n=String(n||"0%");break;case"size":n=String(n||"100%");break;case"align":switch(n=String(n||"middle")){case"start":case"middle":case"end":break;default:throw"Invalid align declaration"}}}return r},destroy:function(){for(var t=0,e=this.cues.length;t<e;t++)this.cues[t].destroy();this.el.mode=this.h,this.cues.length=0,this.activeCues.length=0,this.media=null,this.el=null,this.stopListening()}},{READYSTATE:{NONE:0,LOADING:1,LOADED:2,ERROR:3}}),Media.DOMEvents.add(["texttrackchange","cuechange"]),Media.Class.TextTrackCue=Media.Class.extend({region:null,id:null,startTime:null,endTime:null,vertical:null,snapToLines:null,line:null,lineAlign:null,position:null,positionAlign:null,size:null,textAlign:null,text:null,track$write:null,f:!1,isLive$get$enum:function(){return this.d},isLive$set$enum:function(t){var e;!this.d&&t?e="enter":this.d&&!t&&(e="exit"),e&&(this.d=t,this.trigger(e,this),this.track.media.dispatchEvent("cue"+e,{cue:this}))},constructor:function(t,e,i){this.id="cue-"+ ++Media.Class.TextTrackCue.id,this.startTime=t,this.endTime=e,this.text=i,this.defineProperties({f:!1,track$write:!1})},getCueAsHTML:function(){var t=this.track.media.options.classprefix,e=document.createElement("span"),i={id:this.id,lang:this.track.language,class:t+"cue",style:""};for(var n in this.renderCuePlacement(i,this),i)e.setAttribute(n,i[n]);var r=document.createElement("span");return r.setAttribute("class",t+"cue-text"),r.innerHTML='<span class="'+t+'cue-line">'+this.text.replace(/\n/g,'</span><br><span class="'+t+'cue-line">')+"</span>",e.appendChild(r),e},renderCuePlacement$write:function(t,e){var i=this.track.media.options.classprefix,n=t.class.split(" ");n.push(i+"cue-"+e.vertical);var r="position: absolute;";switch(e.vertical){case"horizontal":switch(r+="transform: translateX(-50%);",e.lineAlign){case"start":r+="text-align: left;",n.push(i+"cue-align-left");break;case"middle":r+="text-align: center;",n.push(i+"cue-align-center");break;case"end":r+="text-align: right;",n.push(i+"cue-align-right")}r+="width:"+e.size+";",r+="left:"+e.position+";",-1<String(e.line).indexOf("%")||0<=e.line?(e.line,r+="top:"+e.line+"%"):r+="bottom:"+(100-100*Math.abs(e.line))+"%";break;case"rl":switch(r+="transform: translateY(-50%);",e.lineAlign){case"start":r+="text-align: left;",n.push(i+"cue-align-top");break;case"middle":r+="text-align: center;",n.push(i+"cue-align-middle");break;case"end":r+="text-align: right;",n.push(i+"cue-align-bottom")}r+="height:"+e.size+";",r+="top:"+e.position+";",-1<String(e.line).indexOf("%")||0<=e.line?(e.line,r+="left:"+e.line+"%"):r+="right:"+(100-100*Math.abs(e.line))+"%";break;case"lr":switch(r+="transform: translateY(-50%);",e.lineAlign){case"start":r+="text-align: left;",n.push(i+"cue-align-top");break;case"middle":r+="text-align: center;",n.push(i+"cue-align-middle");break;case"end":r+="text-align: right;",n.push(i+"cue-align-bottom")}r+="height:"+e.size+";",r+="top:"+e.position+";",-1<String(e.line).indexOf("%")||0<=e.line?(e.line,r+="right:"+e.line+"%"):r+="left:"+(100-100*Math.abs(e.line))+"%"}return t.class=n.join(" "),t.style=r,t},destroy:function(){this.media=null}},{id:0}),Media.DOMEvents.add(["cueenter","cueexit"]),Media.Class.TextTrackList=Media.Class.List.extend({media$write:null,constructor:function(t){this.defineProperties({media$write:t}),this.fetch()},default$get:function(){return this.find(function(t){return t.default})},fetch$write:function(){this.destroy();var n={},t=this.media.el.querySelectorAll("track[type='text/vtt']");toArray(t).forEach(function(t){var e=t.getAttribute("srclang"),i=t.getAttribute("src");e&&i&&!n[e]&&(n[e]=new Media.Class.TextTrack(this.media,t))},this),this.addTracks(ObjectValues(n))},addTracks$write:function(t){for(var e=0,i=t.length;e<i;e++)this.addTrack(t[e])},addTrack:function(t){for(var e=0,i=this.length;e<i;e++)if(this[e]===t)return;this.push(t),this.trigger("add",t,this),this.media.dispatchEvent("addtexttrack",{track:t})},removeTrack:function(t){for(var e=!1,i=this.length-1;-1<i;i--)this[i]===t&&(this.splice(i,1),e=!0);e&&(this.trigger("remove",t,this),this.media.dispatchEvent("removetexttrack",{track:t}))},getTrackById:function(t){for(var e=0,i=this.length;e<i;e++)if(this[e].el.id===t)return this[e];return null},destroy:function(){for(var t=0,e=this.length;t<e;t++)this[t].destroy();this.length=0,this.stopListening()}}),Media.DOMEvents.add(["addtexttrack","removetexttrack"]),Media.Class.TextTracks=Media.Class.extend({constructor:function(t){this.listenTo(Media,{create:this.onCreate,timeupdate:this.onTimeUpdate,destroy:this.onDestroy})},onCreate:function(t){t.defineProperties({tracks$enum$write:new Media.Class.TextTrackList(t)})},onTimeUpdate:function(t,e){if(e.slow)for(var i=0,n=t.tracks.length;i<n;i++)t.tracks[i].update()},onDestroy:function(t){t.tracks&&(t.tracks.destroy(),delete t.tracks)}},null,{instanceEvents:!0}),Media.defineProperties({texttracks$write:new Media.Class.TextTracks}),Media.Class.TimeUpdate=Media.Class.extend({playing:null,interval:null,slowInterval:null,inRaf:!1,lastTickTime:null,slowLastTickTime:null,mediumLastTickTime:null,constructor:function(){this.playing=[],this.listenTo(Media,{play:this.onPlay,"pause finish destroyed":this.onPause}),this.onRaf=this.onRaf.bind(this)},onPlay:function(t){for(var e=0,i=this.playing.length;e<i;e++)if(this.playing[e]===t)return;this.playing.push(t),this.inRaf||(rafer.request(this.onRaf),this.inRaf=!0)},onRaf:function(){var t=Media.DefaultOptions.get("fpsfast");this.interval=1e3/t,this.mediumInterval=1e3/(Media.DefaultOptions.get("fpsmedium")||t/2),this.slowInterval=1e3/(Media.DefaultOptions.get("fpsslow")||t/3);var e=Date.now();if(e<this.lastTickTime+this.interval)return this.playing.length?rafer.request(this.onRaf):this.inRaf=!1;var i={fast:!0,medium:!1,slow:!1};e>=this.mediumLastTickTime+this.mediumInterval&&(this.mediumLastTickTime=e,i.medium=!0),e>=this.slowLastTickTime+this.slowInterval&&(this.slowLastTickTime=e,i.slow=!0),this.lastTickTime=e;for(var n=0,r=this.playing.length;n<r;n++)this.playing[n].dispatchEvent("timeupdate",i);return rafer.request(this.onRaf)},onPause:function(t){for(var e=this.playing.length-1;-1<e;e--)this.playing[e]===t&&this.playing.splice(e,1)}},null,{instanceEvents:!0}),Media.defineProperties({timeupdate$write:new Media.Class.TimeUpdate}),Media.DefaultOptions.add({fpsfast:60,fpsmedium:30,fpsslow:12}),Media.defineProperties({utils$write:{}}),Media.utils.Rafer=Rafer,Media.utils.rafer=rafer,Media.utils.Class=Class,Media.utils.List=List,Media.utils.Elements=Elements,Media.utils.elements=elements,Media.utils.Events=Events,Media.utils.EventsInitialize=EventsInitialize,Media.utils.EventsArgumentsNotation=EventsArgumentsNotation,Media.utils.EventRegister=EventRegister,Media.utils.EventsRegistry=EventsRegistry,Media.utils.properties=properties,Media.utils.toArray=toArray,Media.utils.isArray=isArray,Media.utils.isObject=isObject,Media.utils.extend=extend,Media.utils.extendNotEnumerable=extendNotEnumerable,Media.utils.deepDefaults=deepDefaults,Media.utils.defaults=defaults,Media.utils.indexOfRegex=indexOfRegex,Media.utils.lastIndexOfRegex=lastIndexOfRegex,Media.utils.includes=includes,Media.utils.replace=replace,Media.utils.parseUnit=parseUnit,Media.utils.delay=delay,Media.utils.debounce=debounce,Media.utils.bindAll=bindAll,Media.utils.toggleClass=toggleClass,Media.utils.removeAttribute=removeAttribute,Media.utils.removeElement=removeElement,Media.utils.toggleClass=toggleClass,Media.utils.prependElement=prependElement,Media.utils.createEvent=createEvent;})(window, window.jQuery);
